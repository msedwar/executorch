#pragma once

#include <cstdint>

namespace torch {
namespace executor {
// instruction look like:
// op_code X, N
// op_code: 8-bit int
// X: 32-bit int
// N: 8-bit int for padding (reserved for possible future extension)

// meaning of X, N depend on the op:
// K - index of the kernel table
// P - jump offset relative to beginning of current instruction


#define FORALL_OPCODES(_)                                                      \
  _(CALL_KERNEL, "K") /* invoke kernel X */                                           \
  _(JF, "P") /* pop the top of the stack, if false, branch to P */

enum OpCode : uint8_t {
#define DEFINE_OP(op, _) op,
  FORALL_OPCODES(DEFINE_OP)
#undef DEFINE_OP
};

struct Instruction {
  OpCode op;
  uint8_t N;
  int32_t X;
  // TODO: check for overflow
  Instruction(OpCode op, int32_t X, uint8_t N)
      : op(op), unused(0), N(N), X(X) {}
};
} // namespace jit
} // namespace torch
